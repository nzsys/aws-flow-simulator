# Lessons Learned

## 2026-02-18: 個別修正ではなく体系的な問題を疑う

**状況**: WAFのコスト計算が不正確だと指摘を受け、WAFだけを個別修正した。その後ユーザーから「他のサービスにも同じ問題がないか？」と指摘され、全16サービスに同様の問題があることが判明。

**根本原因**: basic engineの汎用計算式（`perRequest + perGB + monthly`）自体がほとんどのサービスに不適切だった。DynamoDBとWAFの2つが既に特殊処理を必要としていた時点で、汎用アプローチの限界に気づくべきだった。

**ルール**:
- 同じパターンの特殊処理が2つ以上必要になったら、設計そのものを疑う
- バグ修正時は「同じカテゴリの他の箇所にも同じ問題がないか」を必ず確認する
- パッチの積み重ねではなく、根本原因の解決を優先する
- 既存の共通関数（calculator.ts）があるなら、最初からそれを活用する
